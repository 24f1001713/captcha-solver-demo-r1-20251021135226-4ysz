<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Auto-generated Captcha Solver Demo</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; padding: 1rem; max-width: 800px; margin: auto; }
    img { max-width: 100%; height: auto; border: 1px solid #ddd; padding: 4px; }
    pre { background:#f6f8fa; padding: 1rem; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Captcha solver demo</h1>
  <p id="info">Pass the captcha image using <code>?url=https://example.com/image.png</code>. Defaults to attached sample if not provided.</p>
  <div>
    <img id="captcha" alt="captcha image" />
  </div>
  <div style="margin-top: 1rem;">
    <button id="solveBtn">Solve (using Tesseract.js)</button>
    <button id="resetBtn">Reload image</button>
  </div>
  <h2>Result</h2>
  <pre id="result">Not solved yet</pre>

  <!-- Tesseract.js CDN -->
  <script src="https://unpkg.com/tesseract.js@v4.1.1/dist/tesseract.min.js"></script>
  <script>
  (function(){
    function getQueryParam(name){
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }
    const img = document.getElementById('captcha');
    const result = document.getElementById('result');
    const info = document.getElementById('info');

    function setImageSrc(url) {
      img.src = url;
      img.onload = function(){ result.textContent = 'Image loaded â€” click Solve.'; };
      img.onerror = function(){ result.textContent = 'Failed to load image.'; };
    }

    const urlParam = getQueryParam('url');
    if (urlParam) {
      setImageSrc(urlParam);
    } else {
      // default to attachments/sample.png
      setImageSrc('./attachments/sample.png');
    }

    document.getElementById('solveBtn').addEventListener('click', function(){
      result.textContent = 'Working... (this may take a few seconds)';
      Tesseract.recognize(img.src, 'eng', { logger: m => {
        // update progress
        if (m && m.status) {
          result.textContent = 'Progress: ' + m.status + ' ' + (m.progress? Math.round(m.progress*100) + '%':'');
        }
      }}).then(({ data: { text } }) => {
        result.textContent = text.trim() || '(no text found)';
      }).catch(err => {
        result.textContent = 'OCR error: ' + err.message;
      });
    });

    document.getElementById('resetBtn').addEventListener('click', function(){
      if (urlParam) setImageSrc(urlParam);
      else setImageSrc('./attachments/sample.png');
      result.textContent = 'Not solved yet';
    });
  })();
  </script>
</body>
</html>
